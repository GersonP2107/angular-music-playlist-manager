<div class="bg-[#121212] min-h-screen p-6 text-white pb-24">
    <div class="mb-8 max-w-2xl mx-auto">
        <h1 class="text-3xl font-bold mb-6 text-center">Resultados de Búsqueda</h1>
    </div>

    @if (loading) {
    <div class="flex justify-center my-12">
        <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-green-500"></div>
    </div>
    }

    @if (!loading && songs.length === 0 && hasSearched) {
    <div class="text-center text-zinc-400 mt-12">
        <p class="text-xl">No se encontraron resultados</p>
        <p class="mt-2 text-sm">Prueba buscando un artista o canción</p>
    </div>
    }

    @if (songs.length > 0) {
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
        @for (song of songs; track $index) {
        <div class="bg-[#181818] p-4 rounded-md hover:bg-[#282828] transition-colors group flex gap-4 items-center">
            <div class="relative min-w-[80px] w-20 h-20 shadow-lg">
                <img [src]="song.artworkUrl100" alt="{{song.trackName}}" class="w-full h-full object-cover rounded-md">

                <button (click)="playPreview(song.previewUrl)"
                    class="absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                    @if (currentPlayingUrl !== song.previewUrl) {
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                        class="w-10 h-10 text-white drop-shadow-lg">
                        <path fill-rule="evenodd"
                            d="M4.5 5.653c0-1.426 1.529-2.33 2.779-1.643l11.54 6.348c1.295.712 1.295 2.573 0 3.285L7.28 19.991c-1.25.687-2.779-.217-2.779-1.643V5.653Z"
                            clip-rule="evenodd" />
                    </svg>
                    } @else {
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                        class="w-10 h-10 text-green-500 drop-shadow-lg">
                        <path fill-rule="evenodd"
                            d="M6.75 5.25a.75.75 0 0 1 .75-.75H9a.75.75 0 0 1 .75.75v13.5a.75.75 0 0 1-.75.75H7.5a.75.75 0 0 1-.75-.75V5.25Zm7.5 0A.75.75 0 0 1 15 4.5h1.5a.75.75 0 0 1 .75.75v13.5a.75.75 0 0 1-.75.75H15a.75.75 0 0 1-.75-.75V5.25Z"
                            clip-rule="evenodd" />
                    </svg>
                    }
                </button>
            </div>

            <div class="flex-1 min-w-0">
                <h3 class="font-bold text-white truncate text-base mb-1">{{ song.trackName }}</h3>
                <p class="text-sm text-zinc-400 truncate">{{ song.artistName }}</p>
                <p class="text-xs text-zinc-500 mt-1 truncate">{{ song.collectionName }}</p>
            </div>

            <button (click)="openAddToPlaylistModal(song)"
                class="text-zinc-400 hover:text-white p-2 rounded-full hover:bg-white/10" title="Añadir a playlist">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                </svg>
            </button>

            <audio [src]="song.previewUrl" #audioPlayer></audio>
        </div>
        }
    </div>
    }

    <!-- Add to Playlist Modal -->
    @if (showPlaylistModal) {
    <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm animate-fade-in"
        (click)="closeModal()">
        <div class="bg-[#282828] rounded-lg shadow-2xl w-full max-w-sm border border-[#3e3e3e] transform transition-all scale-100 overflow-hidden"
            (click)="$event.stopPropagation()">
            <div class="p-4 border-b border-white/5 flex items-center justify-between">
                <h2 class="text-xl font-bold text-white">Añadir a playlist</h2>
                <button (click)="closeModal()" class="text-zinc-400 hover:text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                        </path>
                    </svg>
                </button>
            </div>

            <div class="max-h-[60vh] overflow-y-auto p-2">
                <!-- Liked Songs Option -->
                <button (click)="addToLikedSongs()"
                    class="w-full flex items-center gap-3 p-3 hover:bg-white/10 rounded-md transition-colors text-left group">
                    <div
                        class="w-12 h-12 rounded bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center shadow-lg group-hover:scale-105 transition-transform">
                        <svg class="w-6 h-6 text-white leading-none" fill="currentColor" viewBox="0 0 24 24">
                            <path
                                d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
                        </svg>
                    </div>
                    <div>
                        <div class="font-bold text-white">Canciones que me gustan</div>
                        <div class="text-xs text-zinc-400">Favoritas</div>
                    </div>
                </button>

                <hr class="border-white/5 my-2 mx-2">

                @for (playlist of userPlaylists; track playlist.id) {
                <!-- Only show non-liked songs playlists here if we want to avoid duplicate logic, but usually Liked Songs is hidden from this list by backend query unless specifically included. 
                     Assuming userPlaylists contains normal playlists. -->
                @if (playlist.name !== 'Liked Songs') {
                <button (click)="addToPlaylist(playlist)"
                    class="w-full flex items-center gap-3 p-3 hover:bg-white/10 rounded-md transition-colors text-left group">
                    <div
                        class="w-12 h-12 rounded bg-zinc-800 flex items-center justify-center overflow-hidden shadow-lg">
                        @if (playlist.image_url) {
                        <img [src]="playlist.image_url" class="w-full h-full object-cover">
                        } @else {
                        <svg class="w-6 h-6 text-zinc-500" fill="currentColor" viewBox="0 0 24 24">
                            <path
                                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 14.5c-2.49 0-4.5-2.01-4.5-4.5S9.51 7.5 12 7.5s4.5 2.01 4.5 4.5-2.01 4.5-4.5 4.5z" />
                        </svg>
                        }
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="font-bold text-white truncate">{{ playlist.name }}</div>
                        <div class="text-xs text-zinc-400 truncate">{{ playlist.description || 'Sin descripción' }}
                        </div>
                    </div>
                </button>
                }
                }

                @if (userPlaylists.length === 0) {
                <div class="text-center py-6 text-zinc-500 text-sm">
                    No tienes playlists creadas.
                </div>
                }
            </div>

            <div class="p-4 border-t border-white/5 bg-[#222]">
                <button (click)="closeModal()"
                    class="w-full py-2 bg-transparent text-white font-bold hover:bg-white/10 rounded-full transition-colors border border-white/20">
                    Cancelar
                </button>
            </div>
        </div>
    </div>
    }
</div>